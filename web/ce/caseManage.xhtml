<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link rel="stylesheet" type="text/css" href="css/style.css"></link>
        <title>Case Manager</title>
    </h:head>
    <h:body>
        <ui:composition template="./../tempHeadFoot.xhtml">
            <ui:define name="content">
                <div class="mainContainer">
                    <h:messages globalOnly="true" showDetail="false" showSummary="true"
                                    warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError">
                    </h:messages>
                            
                    <h1>Case Manager</h1>
                    <f:view>
                        <h2>Case: <h:outputText value="#{caseManageBB.currentCase.caseName}"/></h2>
                        <h:form id="caseManagerForm">
                            
                            
                            <h:outputText value="Current Phase: #{caseManageBB.currentCase.casePhase.label}"/>
                            
                            <h2>Code Violations</h2>
                                <p:commandButton ajax="false" action="#{caseManageBB.addViolation}"
                                                 value="Add new code violation to case"/>
                                <p:spacer height="15px"/>

                                <p:dataTable
                                 id="violationTable"
                                 var="v"
                                 selectionMode="single"
                                 selection="#{caseManageBB.selectedViolation}"
                                 rowKey="#{v.violationID}"
                                 value="#{caseManageBB.violationList}"
                                 tableStyleClass="primeDataTable"
                                 expandedRow="false"
                                 rowExpandMode="multiple"
                                 draggableColumns="true"
                                 reflow="true"
                               
                                 >
                                    
                                    
                                 <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->
                                    <f:facet name="header">
                                        Expand rows to see detailed info about each violation
                                    </f:facet>
                                    <p:column>
                                        <p:rowToggler />
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Code Element" />
                                        </f:facet>
                                        <h:outputText value="#{v.violatedEnfElement.codeElement.ordsecTitle}: #{v.violatedEnfElement.codeElement.ordSubSecTitle}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Stipulated Comp. Date" />
                                        </f:facet>
                                        <h:outputText value="#{v.stipulatedComplianceDate}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Actual Comp. Date" />
                                        </f:facet>
                                        <h:outputText value="#{v.actualComplianceDate}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Citation Date" />
                                        </f:facet>
                                        <h:outputText value="#{v.dateOfCitation}"/>
                                    </p:column>
                                 
                                    <p:rowExpansion>
                                       <h:outputLabel value="Violated Element Details: "/>
                                       <h:outputLabel value="#{v.violatedEnfElement.codeElement.ordchapterTitle}: 
                                                      #{v.violatedEnfElement.codeElement.ordSecNum} 
                                                      #{v.violatedEnfElement.codeElement.ordsecTitle}:
                                                      #{v.violatedEnfElement.codeElement.ordSubSecNum} 
                                                      #{v.violatedEnfElement.codeElement.ordSubSecTitle}"/>
                                       <p:spacer height="5px"/>
                                       
                                       <h:outputText value="#{v.violatedEnfElement.codeElement.ordTechnicalText}"/>

                                       <p:spacer height="5px"/>
                                       
                                       <h:outputLabel value="Penalty:"/>
                                       <h:outputText value="#{v.penalty}"/>
                                       
                                       <h:outputLabel value="Description: "/>
                                       <h:outputText value="#{v.description}"/>
                                       
                                       <p:spacer height="5px"/>
                                       
                                       <h:outputLabel value="Violation Notes: "/>
                                       <h:outputText value="#{v.notes}"/>

                                    </p:rowExpansion>

                                </p:dataTable> 
                                
                                <p:spacer height="15px"/>
                                
                                <h:outputText style="font-style: italic" value="The following buttons all act on a single selected violation:"/>
                                
                                <p:spacer height="5px"/>
                                
                                <p:commandButton ajax="false" action="#{caseManageBB.recordCompliance}"
                                                 value="Record compliance "/>
                                
                                <p:commandButton ajax="false" action="#{caseManageBB.editViolation}"
                                                 value="Edit non-compliance info"/>
                                
                                <p:commandButton ajax="false" action="#{caseManageBB.deleteViolation}"
                                                 value="Nuke forever"/>
                                
                                
                                <p:spacer height="15px"/>
                            </h:form>
                                <p:separator/>

                            <h2>Citations</h2>
                                <h:form id="citationForm">
                                    
                                    


                                </h:form>

                            
                                <p:separator/>
                            <h2>Event Log</h2>
                            
                            <h:form id="eventManagementForm">
                                
                                <p:dataTable
                                    id="caseEventTable"
                                    var="e"
                                    selectionMode="single"
                                    selection="#{caseManageBB.selectedEvent}"
                                    rowKey="#{e.eventID}"
                                    value="#{caseManageBB.eventList}"
                                    tableStyleClass="primeDataTable">
                                    <!--<p:ajax event="rowSelect" update="selectedRowLabel"/>-->

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Date" />
                                        </f:facet>
                                        <h:outputText value="#{e.dateOfRecord}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Type" />
                                        </f:facet>
                                        <h:outputText value="#{e.eventType}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Creator" />
                                        </f:facet>
                                        <h:outputText value="#{e.eventOwnerUser.LName}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Description" />
                                        </f:facet>
                                        <h:outputText value="#{e.eventDescription}"/>
                                    </p:column>
                                    
                                    <p:rowExpansion>
                                        <h:outputLabel value="Disclose to Municipality Staff? "/>
                                        <h:outputText value="#{e.discloseToMunicipality}"/>
                                        
                                        <p:spacer height="10px"/>
                                        
                                        <h:outputLabel value="Disclose to Public? "/>
                                        <h:outputText value="#{e.discloseToPublic}"/>
                                        
                                        <p:spacer height="10px"/>
                                        
                                        <h:outputLabel value="Active Event? "/>
                                        <h:outputText value="#{e.activeEvent}"/>
                                        
                                        <p:spacer height="10px"/>
                                        
                                        <h:outputLabel value="Event Notes: "/>
                                        <h:outputText value="#{e.notes}"/>
                                        
                                    </p:rowExpansion>
                                
                                </p:dataTable>
                            
                            <p:spacer height="15px"/>
                            
                            <p:commandButton ajax="false" action="#{caseManageBB.editSelectedEvent}"
                                             value="Edit Selected Event"/>
                            
                            </h:form>
                            <p:spacer height="15px"/>
                            
                            <h:form id="addNewEventForm">
                                
                             <p:fieldset legend="Add a new event"
                                         toggleable="true" collapsed="false">
                                 
                                <p:spacer height="10px"/>
                                
                                <h:panelGrid columns="2" border="0" 
                                         cellpadding="5" columnClasses="gridTd, gridTd, gridTd, gridTd,"
                                         footerClass="gridFooter">
                                    
                                    <f:facet name="header">
                                        <h:panelGroup>
                                            <p:outputLabel for="eventDesc">
                                                <h:outputText value="Description (1 sentnece ish):"/>
                                            </p:outputLabel>
                                            <p:inputText id="eventDesc" value="#{caseManageBB.formEventDesc}" 
                                                      style="width: 100%;" tabindex="3" required="true" styleClass="inputText"/>
                                            <h:message for="eventDesc" showDetail="false" showSummary="true" 
                                                   warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>
                                    </f:facet>
                                    
                                    <h:panelGroup>
                                        <h:outputLabel for="eventTypeMenu">
                                            <h:outputText value="Event Type"/>
                                        </h:outputLabel>
                                        <p:selectOneMenu id="eventTypeMenu" required="true" value="#{caseManageBB.selectedEventType}" tabindex="3">
                                            <f:selectItems value="#{caseManageBB.eventTypeArr}"/>
                                        </p:selectOneMenu>
                                        <h:message for="eventTypeMenu" showDetail="false" showSummary="true" 
                                        warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <h:outputLabel for="eventDateCal">
                                            <h:outputText value="Date of Record"/>
                                        </h:outputLabel>
                                        <p:calendar value="#{caseManageBB.formEventType}" 
                                                    mode="popup"  id="eventDateCal"
                                                    showOn="button" pattern="EEE, dd MMM, yyyy"
                                                    navigator="true" tabindex="16"
                                                    showButtonPanel="true" showTodayButton="true"
                                                    required="true"/>
                                        <h:message for="eventDateCal" showDetail="false" showSummary="true" 
                                                warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                    </h:panelGroup>
                                        
                                    <h:panelGroup>
                                        <h:outputLabel for="discloseToMuniIS">
                                            <h:outputText value="Disclose to Municipalities"/>
                                        </h:outputLabel>
                                        <p:inputSwitch tabindex="18" id="discloseToMuniIS" value="#{caseManageBB.formDiscloseToMuni}" onLabel="Yes" offLabel="No" />
                                    </h:panelGroup>
                                    
                                    <h:panelGroup>
                                        <h:outputLabel for="discloseToPublic">
                                            <h:outputText value="Disclose to Public"/>
                                        </h:outputLabel>
                                        <p:inputSwitch tabindex="18" id="discloseToPublic" value="#{caseManageBB.formDiscloseToPublic}" onLabel="Yes" offLabel="No" />
                                    </h:panelGroup>
                                       
                                    <f:facet name="footer">
                                        <h:outputLabel for="eventNotes">
                                            <h:outputText value="Event Notes:"/>
                                        </h:outputLabel>
                                        <h:panelGroup>
                                            <p:inputTextarea id="eventNotes" value="#{caseManageBB.formEventNotes}" 
                                                   style="width: 100%;" tabindex="19" required="false" styleClass="inputText"/>
                                            <h:message for="eventNotes" showDetail="false" showSummary="true" 
                                            warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                        </h:panelGroup>
                                    </f:facet>
                                 
                                </h:panelGrid>
                                
                                 <h:outputLabel for="eventPerson">
                                    <h:outputText value="Attach a Property Person"/>
                                 </h:outputLabel>
                                
                                <p:selectOneMenu id="eventPerson" required="true" value="#{caseManageBB.formEventpersonList}" tabindex="3">
                                    <f:selectItems value="#{caseManageBB.eventTypeArr}"/>
                                 </p:selectOneMenu>
                                
                                 <h:message for="eventTypeMenu" showDetail="false" showSummary="true" 
                                 warnClass="msgWarn" infoClass="msgInfo" fatalClass="msgFatal" errorClass="msgError" />
                                 
                             </p:fieldset>
                        </h:form>
                    </f:view>
                </div>
            </ui:define>
        </ui:composition>
    </h:body>
</html>

